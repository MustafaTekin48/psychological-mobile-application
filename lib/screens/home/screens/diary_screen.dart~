import 'package:flutter/material.dart';
import 'package:flutter_application_1/screens/diary/screens/emotion_selection_screen.dart';
import '../../diary/database/diary_database_helper.dart';
import '../../diary/screens/calendar_screen.dart';
import '../../diary/screens/home_screen.dart';

class DiaryScreen extends StatefulWidget {
  @override
  _DiaryScreenState createState() => _DiaryScreenState();
}

class _DiaryScreenState extends State<DiaryScreen> {
  int _selectedIndex = 0;
  List<Map<String, dynamic>> _diaryEntries = [];

  @override
  void initState() {
    super.initState();
    _loadEntries(); // ðŸ“Œ Uygulama aÃ§Ä±ldÄ±ÄŸÄ±nda verileri yÃ¼kle
  }

  Future<void> _loadEntries() async {
    final entries = await DiaryDatabase.instance.getEntries();
    setState(() {
      _diaryEntries = entries;
    });
  }

  Future<void> _addEntry(Map<String, dynamic> newEntry) async {
    await DiaryDatabase.instance.addEntry(newEntry);
    _loadEntries(); // ðŸ“Œ Yeni giriÅŸ eklendiÄŸinde gÃ¼ncelle
  }

  Future<void> _updateEntry(int id, Map<String, dynamic> updatedEntry) async {
    await DiaryDatabase.instance.updateEntry(id, updatedEntry);
    _loadEntries(); // ðŸ“Œ GÃ¼ncellendiÄŸinde yenile
  }

  Future<void> _deleteEntry(int id) async {
    await DiaryDatabase.instance.deleteEntry(id);
    _loadEntries(); // ðŸ“Œ SilindiÄŸinde yenile
  }

  void _onItemTapped(int index) {
    setState(() {
      _selectedIndex = index;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('GÃ¼nlÃ¼klerim', style: TextStyle(color: Colors.black87)),
        backgroundColor: Color(0xFF3F3D56),
      ),
      body: IndexedStack(
        index: _selectedIndex,
        children: [
          HomeScreen(
            diaryEntries: _diaryEntries,
            onRefresh: _loadEntries, // ðŸ“Œ Ana sayfa gÃ¼ncellendiÄŸinde takvimi de gÃ¼ncelle
          ),
          CalendarScreen(
            onEntriesUpdated: _loadEntries, // ðŸ“Œ Takvimde de anÄ±nda gÃ¼ncelle
          ),
          EmotionSelectionScreen(
            onNewEntry: (newEntry) {
              _addEntry(newEntry);
              setState(() {
                _selectedIndex = 0; // ðŸ“Œ Ana ekrana geri dÃ¶n
              });
            },
          ),
        ],
      ),
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: _selectedIndex,
        onTap: _onItemTapped,
        items: [
          BottomNavigationBarItem(
            icon: Icon(Icons.home),
            label: 'Ana Sayfa',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.calendar_today),
            label: 'Takvim',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.book),
            label: 'GÃ¼nlÃ¼k',
          ),
        ],
        selectedItemColor: Colors.white,
        unselectedItemColor: Colors.black87,
        backgroundColor: Color(0xFF3F3D56),
      ),
    );
  }
}
